<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sovereign Control System</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        color: #343a40;
      }
      .header {
        background-color: #212529;
        color: white;
        padding: 20px 0;
        margin-bottom: 30px;
      }
      .card {
        margin-bottom: 20px;
        border: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .card-header {
        background-color: #343a40;
        color: white;
        font-weight: bold;
      }
      .status-badge {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
      }
      .metric-value {
        font-size: 1.5rem;
        font-weight: bold;
      }
      .metric-label {
        font-size: 0.8rem;
        color: #6c757d;
      }
      .footer {
        background-color: #212529;
        color: white;
        padding: 20px 0;
        margin-top: 30px;
      }
      .quantum-field {
        background: linear-gradient(45deg, #4e54c8, #8f94fb);
        color: white;
      }
      .directive-field {
        background: linear-gradient(45deg, #ff9966, #ff5e62);
        color: white;
      }
      .acceleration-field {
        background: linear-gradient(45deg, #56ab2f, #a8e063);
        color: white;
      }
      .control-field {
        background: linear-gradient(45deg, #1e3c72, #2a5298);
        color: white;
      }
      .system-log {
        height: 200px;
        overflow-y: auto;
        background-color: #343a40;
        color: #f8f9fa;
        font-family: monospace;
        padding: 10px;
        border-radius: 5px;
      }
      .log-entry {
        margin: 0;
        padding: 2px 0;
      }
      .flash-messages {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
      }
    </style>
  </head>
  <body>
    <!-- Flash Messages -->
    <div class="flash-messages">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for
      category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="mb-0">Sovereign Control System</h1>
            <p class="mb-0">© 2025 Negative Space Imaging, Inc.</p>
          </div>
          <div class="col-md-4 text-end">
            <span class="badge bg-success">Control ID: {{ state.control_id }}</span>
            <span class="badge bg-info">Mode: {{ current_mode }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container">
      <!-- System Status Overview -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="metric-label">System Health</div>
              <div class="metric-value text-success">{{ status.system_health }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="metric-label">Uptime</div>
              <div class="metric-value">{{ state.uptime_seconds | round(1) }}s</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="metric-label">Task Completion</div>
              <div class="metric-value">{{ status.task_completion }}</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <div class="metric-label">Tasks In Progress</div>
              <div class="metric-value">{{ status.tasks_in_progress }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">Control Panel</div>
            <div class="card-body">
              <div class="row">
                <!-- Initialize System -->
                <div class="col-md-6">
                  <form action="/initialize" method="post" class="mb-3">
                    <div class="card">
                      <div class="card-header bg-primary text-white">Initialize System</div>
                      <div class="card-body">
                        <div class="mb-3">
                          <label for="mode" class="form-label">Operation Mode</label>
                          <select name="mode" id="mode" class="form-select">
                            {% for mode in modes %}
                            <option
                              value="{{ mode }}"
                              {%
                              if
                              mode=""
                              ="current_mode"
                              %}selected{%
                              endif
                              %}
                            >
                              {{ mode }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Initialize</button>
                      </div>
                    </div>
                  </form>
                </div>

                <!-- Execute Directive -->
                <div class="col-md-6">
                  <form action="/execute" method="post" class="mb-3" id="directiveForm">
                    <div class="card">
                      <div class="card-header bg-warning text-dark">Execute Directive</div>
                      <div class="card-body">
                        <div class="mb-3">
                          <label for="directive" class="form-label">Directive</label>
                          <input
                            type="text"
                            name="directive"
                            id="directive"
                            class="form-control"
                            placeholder="Enter directive"
                          />
                        </div>
                        <button type="submit" class="btn btn-warning text-dark">Execute</button>
                      </div>
                    </div>
                  </form>
                </div>

                <!-- Optimize System -->
                <div class="col-md-6">
                  <form action="/optimize" method="post" class="mb-3" id="optimizeForm">
                    <div class="card">
                      <div class="card-header bg-success text-white">Optimize System</div>
                      <div class="card-body">
                        <div class="mb-3">
                          <label for="target" class="form-label">Optimization Target</label>
                          <select name="target" id="target" class="form-select">
                            <option value="all">All Components</option>
                            <option value="quantum">Quantum Framework</option>
                            <option value="hypercognition">Hypercognition System</option>
                            <option value="acceleration">Acceleration System</option>
                            <option value="control">Control System</option>
                          </select>
                        </div>
                        <button type="submit" class="btn btn-success">Optimize</button>
                      </div>
                    </div>
                  </form>
                </div>

                <!-- Sovereign Operation -->
                <div class="col-md-6">
                  <form action="/sovereign" method="post" class="mb-3">
                    <div class="card">
                      <div class="card-header bg-danger text-white">Executive Authority</div>
                      <div class="card-body">
                        <p class="card-text">
                          Execute full sovereign operation with executive authority.
                        </p>
                        <button type="submit" class="btn btn-danger">
                          Begin Sovereign Operation
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Metrics -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">System Metrics</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3">
                  <div class="card quantum-field">
                    <div class="card-body">
                      <h5 class="card-title">Quantum Field</h5>
                      <p class="card-text">
                        Coherence: {{ status.quantum_metrics.field_coherence }}
                      </p>
                      <p class="card-text">
                        Entanglement: {{ status.quantum_metrics.entanglement_strength }}
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card directive-field">
                    <div class="card-body">
                      <h5 class="card-title">Directive Processing</h5>
                      <p class="card-text">
                        Last Directive: {{ state.internal_state.last_directive | default('None') }}
                      </p>
                      <p class="card-text">
                        Execution Time: {{ state.internal_state.last_execution_time | default('N/A')
                        }}
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card acceleration-field">
                    <div class="card-body">
                      <h5 class="card-title">Acceleration Field</h5>
                      <p class="card-text">
                        Stability: {{ status.quantum_metrics.dimensional_stability }}
                      </p>
                      <p class="card-text">Tasks Completed: {{ status.tasks_completed }}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="card control-field">
                    <div class="card-body">
                      <h5 class="card-title">Control System</h5>
                      <p class="card-text">Authority: {{ status.sovereign_authority }}</p>
                      <p class="card-text">Execution: {{ status.execution_state }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System State -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">System State</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <form action="/save" method="post" class="mb-3" id="saveForm">
                    <div class="card">
                      <div class="card-header bg-info text-white">Save System State</div>
                      <div class="card-body">
                        <div class="mb-3">
                          <label for="filename" class="form-label">Filename (optional)</label>
                          <input
                            type="text"
                            name="filename"
                            id="filename"
                            class="form-control"
                            placeholder="Leave blank for auto-generated name"
                          />
                        </div>
                        <button type="submit" class="btn btn-info text-white">Save State</button>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="col-md-6">
                  <form action="/load" method="post" class="mb-3" id="loadForm">
                    <div class="card">
                      <div class="card-header bg-secondary text-white">Load System State</div>
                      <div class="card-body">
                        <div class="mb-3">
                          <label for="path" class="form-label">State File Path</label>
                          <input
                            type="text"
                            name="path"
                            id="path"
                            class="form-control"
                            placeholder="Enter full path to state file"
                          />
                        </div>
                        <button type="submit" class="btn btn-secondary">Load State</button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Log -->
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">System Log</div>
            <div class="card-body">
              <div class="system-log" id="systemLog">
                <p class="log-entry">
                  [{{ state.current_time }}] System initialized with ID: {{ state.control_id }}
                </p>
                <p class="log-entry">
                  [{{ state.current_time }}] Quantum field harmonization: {{
                  status.quantum_field_state }}
                </p>
                <p class="log-entry">
                  [{{ state.current_time }}] System state: {{ status.system_health }}
                </p>
                <p class="log-entry">
                  [{{ state.current_time }}] Tasks: {{ status.tasks_completed }} completed, {{
                  status.tasks_remaining }} remaining
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p>© 2025 Negative Space Imaging, Inc. All Rights Reserved.</p>
          </div>
          <div class="col-md-6 text-end">
            <p>Classification: ULTRA SECRET</p>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Auto-refresh system status every 10 seconds
      setInterval(function () {
        fetch('/status')
          .then((response) => response.json())
          .then((data) => {
            // Update system metrics
            // This would be implemented with more detailed DOM manipulation
            console.log('Status updated:', data);
          })
          .catch((error) => console.error('Error fetching status:', error));
      }, 10000);

      // Handle form submissions via AJAX
      document.getElementById('directiveForm').addEventListener('submit', function (e) {
        e.preventDefault();
        submitForm(this, '/execute');
      });

      document.getElementById('optimizeForm').addEventListener('submit', function (e) {
        e.preventDefault();
        submitForm(this, '/optimize');
      });

      document.getElementById('saveForm').addEventListener('submit', function (e) {
        e.preventDefault();
        submitForm(this, '/save');
      });

      document.getElementById('loadForm').addEventListener('submit', function (e) {
        e.preventDefault();
        submitForm(this, '/load');
      });

      function submitForm(form, endpoint) {
        const formData = new FormData(form);

        fetch(endpoint, {
          method: 'POST',
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log('Response:', data);

            // Add log entry
            const log = document.getElementById('systemLog');
            const now = new Date().toISOString();
            const entry = document.createElement('p');
            entry.className = 'log-entry';
            entry.textContent = `[${now}] ${endpoint.substring(1)} executed: ${JSON.stringify(data).substring(0, 100)}...`;
            log.insertBefore(entry, log.firstChild);

            // Refresh page after a delay
            setTimeout(() => {
              window.location.reload();
            }, 2000);
          })
          .catch((error) => {
            console.error('Error:', error);
            const log = document.getElementById('systemLog');
            const now = new Date().toISOString();
            const entry = document.createElement('p');
            entry.className = 'log-entry';
            entry.style.color = '#ff5555';
            entry.textContent = `[${now}] Error: ${error}`;
            log.insertBefore(entry, log.firstChild);
          });
      }
    </script>
  </body>
</html>
