{% extends "layout.html" %} {% block title %}Sovereign Security - Change Password{% endblock %} {%
block styles %}
<style>
  .change-password-container {
    max-width: 500px;
    margin: 50px auto;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 100, 0.2);
    background: linear-gradient(to bottom right, #1a2035, #1f2940);
  }

  .change-password-header {
    text-align: center;
    color: #3ea6ff;
    margin-bottom: 30px;
  }

  .change-password-form input {
    background-color: rgba(30, 40, 70, 0.8);
    border: 1px solid #3d5170;
    color: #e9ecef;
  }

  .change-password-form input:focus {
    background-color: rgba(30, 40, 70, 0.9);
    border-color: #3ea6ff;
    box-shadow: 0 0 0 0.2rem rgba(62, 166, 255, 0.25);
    color: #e9ecef;
  }

  .submit-btn {
    background-color: #3ea6ff;
    border-color: #3ea6ff;
    width: 100%;
    margin-top: 20px;
  }

  .submit-btn:hover {
    background-color: #2a95ee;
    border-color: #2a95ee;
  }

  .security-icon {
    text-align: center;
    font-size: 48px;
    color: #3ea6ff;
    margin-bottom: 20px;
  }

  .password-strength {
    margin-top: 5px;
    height: 5px;
    border-radius: 2px;
    transition: all 0.3s;
  }

  .password-feedback {
    font-size: 12px;
    margin-top: 5px;
    transition: all 0.3s;
  }

  .password-match-indicator {
    font-size: 12px;
    margin-top: 5px;
    transition: all 0.3s;
  }

  .cancel-btn {
    background-color: transparent;
    border-color: #6c757d;
    margin-top: 10px;
    width: 100%;
  }

  .cancel-btn:hover {
    background-color: #6c757d;
    border-color: #6c757d;
  }
</style>
{% endblock %} {% block content %}
<div class="container">
  <div class="change-password-container">
    <div class="security-icon">
      <i class="fas fa-key"></i>
    </div>

    <div class="change-password-header">
      <h2>Change Password</h2>
      <p class="text-muted">Update your security credentials</p>
    </div>

    {% for category, message in get_flashed_messages(with_categories=true) %}
    <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
    {% endfor %}

    <form
      class="change-password-form"
      method="POST"
      action="{{ url_for('security.change_password') }}"
    >
      <div class="form-group">
        <label for="current_password">Current Password</label>
        <input
          type="password"
          class="form-control"
          id="current_password"
          name="current_password"
          required
        />
      </div>

      <div class="form-group">
        <label for="new_password">New Password</label>
        <input
          type="password"
          class="form-control"
          id="new_password"
          name="new_password"
          required
        />
        <div class="password-strength"></div>
        <div class="password-feedback text-muted"></div>
      </div>

      <div class="form-group">
        <label for="confirm_password">Confirm New Password</label>
        <input
          type="password"
          class="form-control"
          id="confirm_password"
          name="confirm_password"
          required
        />
        <div class="password-match-indicator"></div>
      </div>

      <button type="submit" class="btn btn-primary submit-btn">Change Password</button>
      <a href="{{ url_for('security.dashboard') }}" class="btn btn-outline-secondary cancel-btn"
        >Cancel</a
      >
    </form>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const newPasswordInput = document.getElementById('new_password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const strengthIndicator = document.querySelector('.password-strength');
    const passwordFeedback = document.querySelector('.password-feedback');
    const matchIndicator = document.querySelector('.password-match-indicator');

    // Password strength checker
    newPasswordInput.addEventListener('input', function () {
      const password = this.value;
      let strength = 0;
      let feedback = '';

      if (password.length === 0) {
        strengthIndicator.style.width = '0%';
        strengthIndicator.style.backgroundColor = '#e9ecef';
        passwordFeedback.textContent = '';
        return;
      }

      // Length check
      if (password.length >= 12) {
        strength += 25;
        feedback += '✓ Length (12+ chars) ';
      } else if (password.length >= 8) {
        strength += 15;
        feedback += '✓ Length (8+ chars) ';
      } else {
        feedback += '✗ Too short ';
      }

      // Complexity checks
      if (/[A-Z]/.test(password)) {
        strength += 15;
        feedback += '✓ Uppercase ';
      } else {
        feedback += '✗ No uppercase ';
      }

      if (/[a-z]/.test(password)) {
        strength += 15;
        feedback += '✓ Lowercase ';
      } else {
        feedback += '✗ No lowercase ';
      }

      if (/[0-9]/.test(password)) {
        strength += 15;
        feedback += '✓ Numbers ';
      } else {
        feedback += '✗ No numbers ';
      }

      if (/[^A-Za-z0-9]/.test(password)) {
        strength += 15;
        feedback += '✓ Special chars ';
      } else {
        feedback += '✗ No special chars ';
      }

      // Common patterns check
      if (/123|abc|qwerty|password|admin|user/i.test(password)) {
        strength -= 20;
        feedback += '✗ Common pattern ';
      }

      // Update UI
      strengthIndicator.style.width = `${Math.min(100, strength)}%`;

      if (strength < 40) {
        strengthIndicator.style.backgroundColor = '#dc3545'; // Red
        passwordFeedback.textContent = 'Weak password. ' + feedback;
        passwordFeedback.style.color = '#dc3545';
      } else if (strength < 70) {
        strengthIndicator.style.backgroundColor = '#ffc107'; // Yellow
        passwordFeedback.textContent = 'Moderate password. ' + feedback;
        passwordFeedback.style.color = '#ffc107';
      } else {
        strengthIndicator.style.backgroundColor = '#28a745'; // Green
        passwordFeedback.textContent = 'Strong password. ' + feedback;
        passwordFeedback.style.color = '#28a745';
      }
    });

    // Password match checker
    confirmPasswordInput.addEventListener('input', function () {
      const confirmPassword = this.value;
      const newPassword = newPasswordInput.value;

      if (confirmPassword.length === 0) {
        matchIndicator.textContent = '';
        return;
      }

      if (confirmPassword === newPassword) {
        matchIndicator.textContent = '✓ Passwords match';
        matchIndicator.style.color = '#28a745';
      } else {
        matchIndicator.textContent = '✗ Passwords do not match';
        matchIndicator.style.color = '#dc3545';
      }
    });

    // Focus on current password field
    document.getElementById('current_password').focus();
  });
</script>
{% endblock %}
